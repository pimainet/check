<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Pi Cosmic Vault - Vũ trụ Tương Lai</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Quicksand:wght@400;500;700&family=Orbitron:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link href="./styles/tailwind.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
      html {
        scroll-behavior: smooth;
        overscroll-behavior: contain;
        touch-action: manipulation;
      }
      body {
        background: linear-gradient(135deg, #0a0a23 0%, #1a1a3d 100%);
        color: #e2e8f0;
        font-family: 'Quicksand', sans-serif;
        overflow-x: hidden;
        margin: 0;
        padding-bottom: 80px;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      #header {
        position: fixed;
        top: 0;
        width: 100%;
        background: linear-gradient(90deg, #00f0ff, #1a1a3d, #ff00ff);
        padding: 0.75rem;
        z-index: 100;
        box-shadow: 0 2px 20px rgba(0, 240, 255, 0.8);
      }
      #header .logo {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.75rem;
        font-weight: 700;
        color: #e2e8f0;
        text-shadow: 0 0 10px #00f0ff, 0 0 20px #ff00ff;
        letter-spacing: 1px;
      }
      .settings-btn {
        font-size: 1.75rem;
        background: none;
        border: none;
        color: #e2e8f0;
        cursor: pointer;
        padding: 0.5rem;
        transition: transform 0.3s ease;
      }
      .settings-btn:hover {
        transform: rotate(90deg);
        text-shadow: 0 0 10px #00f0ff;
      }
      #tab-bar {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: linear-gradient(180deg, #0a0a23, #1a1a3d);
        display: flex;
        justify-content: space-around;
        padding: 0.75rem 0;
        z-index: 100;
        border-top: 2px solid #00f0ff;
        box-shadow: 0 -2px 20px rgba(0, 240, 255, 0.5);
      }
      #tab-bar button {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #00f0ff;
        padding: 0.75rem;
        border-radius: 12px;
        color: #e2e8f0;
        font-family: 'Exo 2', sans-serif;
        font-weight: 500;
        font-size: 1rem;
        transition: all 0.3s ease;
        flex: 1;
        margin: 0 0.5rem;
        position: relative;
        overflow: hidden;
      }
      #tab-bar button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.3), transparent);
        transition: left 0.5s ease;
      }
      #tab-bar button:hover::before {
        left: 100%;
      }
      #tab-bar button:hover {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        color: #0a0a23;
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.8);
      }
      #tab-bar button.active {
        background: #00f0ff;
        color: #0a0a23;
        box-shadow: 0 0 15px #00f0ff, 0 0 25px #00f0ff;
      }
      #starfield {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.8;
      }
      #dashboard {
        margin-top: 70px;
        padding: 1.25rem;
        background: rgba(10, 10, 35, 0.9);
        border-radius: 16px;
        border: 2px solid #00f0ff;
        box-shadow: 0 0 25px rgba(0, 240, 255, 0.5);
        animation: fadeIn 1s ease-in;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .avatar-3d {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        border: 4px solid #00f0ff;
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.7), inset 0 0 10px rgba(0, 240, 255, 0.5);
        transition: transform 0.5s ease;
        position: relative;
        background: radial-gradient(circle, #1a1a3d, #0a0a23);
      }
      .avatar-3d::after {
        content: '';
        position: absolute;
        top: -6px;
        left: -6px;
        width: 100px;
        height: 100px;
        border: 2px solid #ff00ff;
        border-radius: 50%;
        animation: rotateHologram 3s linear infinite;
        box-shadow: 0 0 15px #ff00ff;
      }
      @keyframes rotateHologram {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .avatar-3d:hover {
        transform: rotateY(360deg) scale(1.05);
        box-shadow: 0 0 30px rgba(0, 240, 255, 0.9);
      }
      .avatar-3d img {
        filter: brightness(1.2);
      }
      .user-info {
        flex: 1;
        margin-left: 1.25rem;
      }
      .user-info h2 {
        font-family: 'Exo 2', sans-serif;
        font-weight: 700;
        text-shadow: 0 0 5px #00f0ff;
      }
      .user-info span {
        font-family: 'Quicksand', sans-serif;
        font-weight: 500;
      }
      .tab-content {
        display: none;
        padding: 1.25rem;
      }
      .tab-content.active {
        display: block;
      }
      .btn {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        color: #0a0a23;
        font-family: 'Exo 2', sans-serif;
        font-size: 1rem;
        min-width: 130px;
        transition: all 0.3s ease;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
        position: relative;
        overflow: hidden;
      }
      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 0, 255, 0.3), transparent);
        transition: left 0.5s ease;
      }
      .btn:hover::before {
        left: 100%;
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 25px rgba(0, 240, 255, 0.8);
      }
      .btn:active {
        transform: scale(0.95);
      }
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeInOverlay 0.3s ease;
      }
      .modal-overlay.show {
        display: flex;
      }
      @keyframes fadeInOverlay {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .modal {
        background: rgba(15, 15, 45, 0.95);
        border: 2px solid #00f0ff;
        border-radius: 16px;
        padding: 1.5rem;
        max-width: 90%;
        width: 320px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 0 35px rgba(0, 240, 255, 0.6);
        animation: slideInModal 0.3s ease;
      }
      @keyframes slideInModal {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
      .modal::-webkit-scrollbar {
        width: 8px;
      }
      .modal::-webkit-scrollbar-thumb {
        background: #00f0ff;
        border-radius: 4px;
        box-shadow: 0 0 5px #00f0ff;
      }
      .modal-close {
        font-size: 1.5rem;
        cursor: pointer;
        color: #e2e8f0;
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
      }
      .modal-close:hover {
        color: #ff00ff;
        text-shadow: 0 0 5px #ff00ff;
      }
      .plasma-effect {
        position: absolute;
        width: 150px;
        height: 150px;
        opacity: 0;
        animation: plasmaWave 4s ease-in-out forwards;
        pointer-events: none;
        z-index: 50;
      }
      @keyframes plasmaWave {
        0% { transform: translate(-100%, 100%) scale(0); opacity: 0; }
        50% { transform: translate(50%, -50%) scale(1); opacity: 1; }
        100% { transform: translate(200%, -100%) scale(0); opacity: 0; }
      }
      .plasma-effect.show {
        opacity: 1;
      }
      .lotus-hologram {
        position: absolute;
        width: 100px;
        opacity: 0;
        animation: bloomHologram 3s ease-in-out forwards;
        filter: drop-shadow(0 0 15px #00f0ff);
      }
      @keyframes bloomHologram {
        0% { transform: scale(0) rotate(0deg); opacity: 0; }
        50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
        100% { transform: scale(1) rotate(360deg); opacity: 1; }
      }
      .lotus-hologram.show {
        opacity: 1;
      }
      .chat-box {
        border: 2px solid #00f0ff;
        border-radius: 8px;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        height: 150px;
        overflow-y: auto;
        font-size: 0.9rem;
        box-shadow: inset 0 0 10px rgba(0, 240, 255, 0.3);
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #00f0ff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 1rem auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .balance-container {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        padding: 0.5rem;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.7);
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .balance-container span {
        font-family: 'Exo 2', sans-serif;
        font-weight: 700;
        color: #0a0a23;
        text-shadow: 0 0 5px #e2e8f0;
      }
      .video-container {
        position: relative;
        padding-top: 56.25%;
        border: 2px solid #00f0ff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
      }
      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      .safe {
        color: #2ecc71;
        text-shadow: 0 0 8px rgba(46, 204, 113, 0.4);
      }
      .unsafe {
        color: #e74c3c;
        text-shadow: 0 0 8px rgba(231, 76, 60, 0.4);
      }
      @media (max-width: 640px) {
        #header { padding: 0.5rem; }
        .logo { font-size: 1.5rem; }
        .settings-btn { font-size: 1.5rem; }
        #dashboard { margin-top: 60px; padding: 1rem; }
        .avatar-3d { width: 70px; height: 70px; }
        .avatar-3d::after { width: 80px; height: 80px; top: -5px; left: -5px; }
        .user-info { margin-left: 1rem; }
        .user-info h2 { font-size: 1.25rem; }
        .user-info span { font-size: 1rem; }
        .btn { padding: 0.75rem 1.25rem; font-size: 0.95rem; min-width: 110px; }
        .plasma-effect { width: 120px; height: 120px; }
        .lotus-hologram { width: 80px; }
        .video-container { padding-top: 75%; }
        #tab-bar { padding: 0.5rem 0; }
        #tab-bar button { padding: 0.75rem; font-size: 0.95rem; margin: 0 0.25rem; }
        .modal { width: 90%; padding: 1.25rem; }
        .chat-box { height: 120px; }
      }
    </style>
  </head>
  <body>
    <div id="starfield"></div>
    <div id="header" class="flex justify-between items-center">
      <span class="logo">Pi Cosmic Vault</span>
      <button class="settings-btn" onclick="openSettingsModal()">⚙️</button>
    </div>
    <div id="dashboard" class="container mx-auto">
      <div id="loadingSpinner" class="spinner mx-auto" style="display: none;"></div>
      <div class="flex items-center mb-3">
        <div class="avatar-3d">
          <img
            id="avatar"
            src="https://i.imgur.com/6ceGYoC.jpeg"
            alt="Avatar Sci-Fi"
            class="w-full h-full rounded-full"
            loading="lazy"
          />
        </div>
        <div class="user-info">
          <h2 id="userName" class="text-xl font-bold">Nhà du hành vũ trụ</h2>
          <span id="userLevel" class="text-lg">Cấp 1: Nhà Thám Hiểm Vũ Trụ</span>
          <div class="mt-1 balance-container">
            <span class="text-sm">Pi: <span id="piBalance">0</span></span>
            <span class="text-sm">Pidoge: <span id="pidogeBalance">0</span></span>
            <span class="text-sm">tlk: <span id="tlkBalance">0</span></span>
          </div>
        </div>
      </div>
      <div id="wallet" class="tab-content active">
        <p class="text-lg">Mã ví: <span id="walletAddress" class="break-words">Chưa nhập</span></p>
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-3">
          <button onclick="copyWalletAddress()" class="btn">Sao chép</button>
          <button onclick="checkBalance()" class="btn">Kiểm tra</button>
        </div>
      </div>
      <div id="explore" class="tab-content">
        <p class="text-lg">Trạng thái: <span id="checkInStatus">Chưa khám phá</span></p>
        <button id="checkInButton" onclick="checkIn()" class="btn mt-3">Khám phá</button>
        <button onclick="openHistoryModal()" class="btn mt-3">Xem nhật ký</button>
        <div id="leaderboard" class="mt-3">
          <h3 class="text-lg font-semibold">Bảng xếp hạng</h3>
          <ul id="leaderboardList"></ul>
        </div>
      </div>
      <div id="price" class="tab-content">
        <p class="text-lg">Giá Pi: <span id="piPrice">Đang tải...</span></p>
      </div>
      <div id="support" class="tab-content">
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mb-3">
          <button onclick="openSafetyModal()" class="btn">Kiểm tra an toàn</button>
          <button onclick="openChatModal()" class="btn">Chat Grok</button>
        </div>
        <p class="text-lg">Email: <a href="mailto:support@example.com" class="text-yellow-400 hover:text-yellow-300">support@example.com</a></p>
        <p class="text-lg">Hotline: <a href="tel:+84987654321" class="text-yellow-400 hover:text-yellow-300">+84 987 654 321</a></p>
        <div class="video-container mt-3">
          <iframe
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
            title="Hướng dẫn"
            frameborder="0"
            allow="accelerometer; clipboard-write; encrypted-media"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>
      </div>
      <svg id="plasma" class="plasma-effect" viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="80" fill="none" stroke="#00f0ff" stroke-width="10" opacity="0.8">
          <animate attributeName="r" from="80" to="100" dur="1s" repeatCount="indefinite" />
          <animate attributeName="opacity" from="0.8" to="0.2" dur="1s" repeatCount="indefinite" />
        </circle>
        <circle cx="100" cy="100" r="60" fill="none" stroke="#ff00ff" stroke-width="8" opacity="0.6">
          <animate attributeName="r" from="60" to="80" dur="1s" repeatCount="indefinite" />
          <animate attributeName="opacity" from="0.6" to="0.1" dur="1s" repeatCount="indefinite" />
        </circle>
      </svg>
      <img id="lotus" class="lotus-hologram" src="https://source.unsplash.com/100x100/?lotus" alt="Lotus Hologram" loading="lazy" />
    </div>
    <div id="tab-bar">
      <button class="active" onclick="showTab('wallet')">Ví Pi</button>
      <button onclick="showTab('explore')">Khám phá</button>
      <button onclick="showTab('price')">Giá Pi</button>
      <button onclick="showTab('support')">Hỗ trợ</button>
    </div>
    <div id="historyModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('historyModal')">×</span>
        <h2 class="text-xl font-bold">Nhật ký du hành</h2>
        <ul id="checkInHistory" class="mt-3"></ul>
        <button onclick="closeModal('historyModal')" class="btn mt-3">Đóng</button>
      </div>
    </div>
    <div id="safetyModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('safetyModal')">×</span>
        <h2 class="text-xl font-bold">Kiểm tra an toàn</h2>
        <select id="checkType" class="w-full p-2 mt-2 bg-gray-800 text-white rounded border border-gray-600">
          <option value="website">Trang web</option>
          <option value="app">Ứng dụng</option>
        </select>
        <input id="safetyUrl" type="text" placeholder="Nhập URL" class="w-full p-2 mt-2 bg-gray-800 text-white rounded border border-gray-600" />
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-3">
          <button id="checkButton" onclick="checkSafety()" class="btn">Kiểm tra</button>
          <button onclick="clearForm()" class="btn">Xóa</button>
        </div>
        <div id="loadingSpinnerSafety" class="spinner mx-auto mt-4" style="display: none;"></div>
        <div id="safetyResult" class="mt-2 hidden">
          <p>Kết quả: <span id="safetyStatus"></span></p>
          <p>Điểm tin cậy: <span id="safetyScore"></span>/100</p>
          <p>Cảnh báo: <span id="safetyWarnings"></span></p>
        </div>
      </div>
    </div>
    <div id="chatModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('chatModal')">×</span>
        <h2 class="text-xl font-bold">Chat với Grok</h2>
        <div id="chatBox" class="chat-box mt-2"></div>
        <input id="chatInput" type="text" placeholder="Nhập tin nhắn..." class="w-full p-2 mt-2 bg-gray-800 text-white rounded border border-gray-600" />
        <button onclick="sendMessage()" class="btn mt-2">Gửi</button>
      </div>
    </div>
    <div id="settingsModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('settingsModal')">×</span>
        <h2 class="text-xl font-bold">Cài đặt</h2>
        <p>Chưa có tùy chọn cài đặt</p>
        <button onclick="closeModal('settingsModal')" class="btn mt-3">Đóng</button>
      </div>
    </div>
    <audio id="checkInSound" src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-laser-897.mp3"></audio>
    <script>
      const memberData = {
        "001": {
          name: "HOÀNG VĂN MINH",
          avatar: "https://i.imgur.com/6ceGYoC.jpeg",
          wallet_address: "GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ"
        },
        "002": {
          name: "LÊ VĂN HOẰNG",
          avatar: "https://i.imgur.com/bacHB3U.jpeg",
          wallet_address: "GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP"
        },
        "003": {
          name: "PHẠM THỊ XUÂN",
          avatar: "https://i.imgur.com/FgV7fRT.jpeg",
          wallet_address: "GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4"
        },
        "004": {
          name: "LÊ THỊ HƯƠNG",
          avatar: "https://i.imgur.com/qPmerTD.jpeg",
          wallet_address: "GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3"
        },
        "005": {
          name: "LÊ TRỌNG KHOA",
          avatar: "https://i.imgur.com/h2G4JTA.jpeg",
          wallet_address: "GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ"
        },
        "006": {
          name: "HOÀNG VĂN TRỤ",
          avatar: "https://i.imgur.com/wNUTVEz.jpeg",
          wallet_address: "GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN"
        },
        "007": {
          name: "MINH TRANG",
          avatar: "https://i.imgur.com/HskgNhC.jpeg",
          wallet_address: "GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6"
        },
        "008": {
          name: "LÊ THỊ HÀ",
          avatar: "https://i.imgur.com/zAX7aF4.jpeg",
          wallet_address: "GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
          explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS"
        }
      };
      const LEVEL_NAMES = { 1: 'Cấp 1: Nhà Thám Hiểm Vũ Trụ', 2: 'Cấp 2: Người Dẫn Lối Ngôi Sao', 3: 'Cấp 3: Bậc Thầy Thiên Hà' };

      function initStarfield() {
        if (typeof particlesJS === 'undefined') {
          document.getElementById('starfield').style.background = '#0a0a23';
          return;
        }
        particlesJS('starfield', {
          particles: { number: { value: 60 }, color: { value: '#fff' }, size: { value: 2 }, move: { speed: 1.5, direction: 'bottom' } },
          interactivity: { events: { resize: true } },
        });
      }

      function showToast(message, type = "success") {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.position = 'fixed';
        toast.style.top = '20px';
        toast.style.right = '20px';
        toast.style.background = type === "success" ? '#00f0ff' : '#ff00ff';
        toast.style.padding = '0.75rem 1.5rem';
        toast.style.borderRadius = '8px';
        toast.style.color = '#0a0a23';
        toast.style.boxShadow = '0 0 10px #00f0ff';
        toast.style.zIndex = '1001';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('#tab-bar button').forEach(b => b.classList.remove('active'));
        document.querySelector(`#tab-bar button[onclick*="showTab('${tabId}')"]`).classList.add('active');
      }

      function openModal(modalId) { document.getElementById(modalId).classList.add('show'); }
      function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }

      function openSettingsModal() { openModal('settingsModal'); }

      function loadUserData() {
        const loadingSpinner = document.getElementById('loadingSpinner');
        const tagId = new URLSearchParams(window.location.search).get('tag_id');
        const userName = document.getElementById('userName');
        const walletAddress = document.getElementById('walletAddress');
        const avatar = document.getElementById('avatar');
        loadingSpinner.style.display = 'block';
        if (tagId && memberData[tagId]) {
          const member = memberData[tagId];
          userName.textContent = member.name;
          walletAddress.textContent = member.wallet_address;
          avatar.src = member.avatar;
          document.getElementById('userLevel').textContent = LEVEL_NAMES[1];
        } else {
          userName.textContent = 'Không tìm thấy thông tin';
          walletAddress.textContent = 'Không tìm thấy địa chỉ ví';
          avatar.src = 'https://source.unsplash.com/100x100/?space,astronaut';
          showToast('Tag ID không hợp lệ!', 'error');
        }
        avatar.onload = () => {
          avatar.classList.add('loaded');
        };
        avatar.onerror = () => {
          avatar.src = 'https://source.unsplash.com/100x100/?space,astronaut';
          showToast('Không thể tải hình ảnh đại diện!', 'error');
        };
        loadingSpinner.style.display = 'none';
      }

      async function checkIn() {
        const tagId = new URLSearchParams(window.location.search).get('tag_id');
        if (!tagId) return showToast('Tag ID không hợp lệ', 'error');
        const plasma = document.getElementById('plasma');
        plasma.classList.add('show');
        const lotus = document.getElementById('lotus');
        lotus.classList.add('show');
        const sound = document.getElementById('checkInSound');
        sound.play();
        showToast('Khám phá thành công!');
        document.getElementById('checkInStatus').textContent = 'Đã khám phá';
      }

      function copyWalletAddress() {
        const walletAddress = document.getElementById('walletAddress').textContent;
        if (walletAddress === 'Không tìm thấy địa chỉ ví') return showToast('Không có mã ví', 'error');
        navigator.clipboard.writeText(walletAddress).then(() => showToast('Đã sao chép'));
      }

      function checkBalance() {
        const walletAddress = document.getElementById('walletAddress').textContent;
        if (walletAddress === 'Không tìm thấy địa chỉ ví') return showToast('Không có mã ví', 'error');
        window.open(`https://blockexplorer.minepi.com/mainnet/accounts/${walletAddress}`);
      }

      function checkSafety() {
        const checkButton = document.getElementById('checkButton');
        const loadingSpinner = document.getElementById('loadingSpinnerSafety');
        const safetyResult = document.getElementById('safetyResult');
        const safetyStatus = document.getElementById('safetyStatus');
        const safetyScore = document.getElementById('safetyScore');
        const safetyWarnings = document.getElementById('safetyWarnings');

        checkButton.disabled = true;
        loadingSpinner.style.display = 'block';
        safetyResult.classList.add('hidden');

        setTimeout(() => {
          loadingSpinner.style.display = 'none';
          safetyResult.classList.remove('hidden');

          const isSafe = Math.random() > 0.5;
          safetyResult.classList.remove('safe', 'unsafe');
          safetyResult.classList.add(isSafe ? 'safe' : 'unsafe');
          safetyStatus.textContent = isSafe ? 'An toàn' : 'Không an toàn';
          safetyScore.textContent = isSafe ? '85' : '30';
          safetyWarnings.textContent = isSafe ? 'Không có cảnh báo' : 'Trang web có thể không đáng tin cậy';

          checkButton.disabled = false;
          showToast(isSafe ? 'Kiểm tra thành công: An toàn!' : 'Kiểm tra thành công: Không an toàn!', isSafe ? 'success' : 'error');
        }, 1500);
      }

      function clearForm() {
        document.getElementById('safetyUrl').value = '';
        document.getElementById('safetyResult').classList.add('hidden');
        showToast('Đã xóa biểu mẫu!');
      }

      function sendMessage() {
        const chatInput = document.getElementById('chatInput');
        const chatBox = document.getElementById('chatBox');
        const message = chatInput.value;
        if (!message) return;
        chatBox.innerHTML += `<p><strong>Bạn:</strong> ${message}</p>`;
        chatBox.innerHTML += `<p><strong>Grok:</strong> Chào bạn! Tôi đang xử lý...</p>`;
        chatInput.value = '';
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function loadPrice() {
        document.getElementById('piPrice').textContent = '$0.015 (Giả lập)';
      }

      function loadLeaderboard() {
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = `
          <li>Người dùng 1 - 1000 Pi</li>
          <li>Người dùng 2 - 800 Pi</li>
          <li>Người dùng 3 - 500 Pi</li>
        `;
      }

      function loadCheckInHistory() {
        const checkInHistory = document.getElementById('checkInHistory');
        checkInHistory.innerHTML = `
          <li>Khám phá - 2025-05-01</li>
          <li>Khám phá - 2025-05-02</li>
        `;
      }

      function openHistoryModal() {
        loadCheckInHistory();
        openModal('historyModal');
      }

      document.addEventListener('DOMContentLoaded', () => {
        initStarfield();
        loadUserData();
        loadPrice();
        loadLeaderboard();
        setTimeout(() => {
          const plasma = document.getElementById('plasma');
          plasma.classList.add('show');
        }, 1000);
      });
    </script>
  </body>
</html>
